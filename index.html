<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Collagen sequence display and highlighting tool</title>
<!--[if lt IE 9]>
<script src="http://html5shiv.googlecode.com/svn/trunk/html5.js">
</script>
<![endif]-->
<link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.2/themes/smoothness/jquery-ui.css" />
<style>
body {font-family: Verdana, sans-serif; font-size:0.8em;}
header, nav, section, footer {border:1px solid grey; margin:5px; padding:8px;}
nav ul {margin:0; padding:0;}
nav ul li {display:inline; margin:5px;}
.parent {
    display: flex;
    align-items: stretch;
    justify-content: space-around;
}
.child {
    width: 50%;

}
p.outputchain, p.tidied {
  /*color:green;*/
  font-family: Courier New,Courier;
  font-size:15pt;
  margin:0;
	  }
.red {color:red;}
.highlight {color:red;font-weight:bold;}
</style>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.2/jquery-ui.min.js"></script>
<script src="jQueryHighlightRegex.js"></script>
</head>

<body>

<header>
<h1>Collagen sequence display and highlighting tool</h1>

</header>

<div class="parent">
<section class="child">
<h2>Input sequences here</h2>

<p>Type your sequence into the box.</p>

<article id="input">
  Leading chain:<br />
  <textarea class="inputchain" rows="4" cols="100">QMSYGYDEKSAGVSVPGPMGPSGPRGLPGPPGAPGPQGFQGPPGEPGEPGGSGPMGPRGPPGPPGKNGDDGEAGKPGRPGERGPPGPQGARGLPGTAGLPGMKGHRGFSGLDGAKGDAGPAGPKGEPGSPGENGAPGQMGPRGLPGERGRPGPPGTAGARGNDGAVGAAGPPGPTGPTGPPGFPGAVGAKGEAGPQGARGSEGPQGVRGEPGPPGPAGAAGPAGNPGADGQPGAKGANGAPGIAGAPGFPGARGPSGPQGPSGPPGPKGNSGEPGAPGNKGDTGAKGEPGATGVQGPPGPAGEEGKRGARGEPGPSGLPGPPGERGGPGSRGFPGADGVAGPKGPSGERGAPGPAGPKGSPGEAGRPGEAGLPGAKGLTGSPGSPGPDGKTGPPGPAGQDGRPGPAGPPGARGQAGVMGFPGPKGTAGEPGKAGERGLPGPPGAVGPAGKDGEAGAQGAPGPAGPAGERGEQGPAGSPGFQGLPGPAGPPGEAGKPGEQGVPGDLGAPGPSGARGERGFPGERGVQGPPGPAGPRGNNGAPGNDGAKGDTGAPGAPGSQGAPGLQGMPGERGAAGLPGPKGDRGDAGPKGADGSPGKDGARGLTGPIGPPGPAGAPGDKGEAGPSGPPGPTGARGAPGDRGEAGPPGPAGFAGPPGADGQPGAKGEPGDTGVKGDAGPPGPAGPAGPPGPIGNVGAPGPKGPRGAAGPPGATGFPGAAGRVGPPGPSGNAGPPGPPGPVGKEGGKGPRGETGPAGRPGEVGPPGPPGPAGEKGSPGADGPAGSPGTPGPQGIAGQRGVVGLPGQRGERGFPGLPGPSGEPGKQGPSGSSGERGPPGPMGPPGLAGPPGESGREGSPGAEGSPGRDGAPGAKGDRGETGPAGPPGAPGAPGAPGPVGPAGKNGDRGETGPAGPAGPIGPAGARGPAGPQGPRGDKGETGEQGDRGIKGHRGFSGLQGPPGSPGSPGEQGPSGASGPAGPRGPPGSAGSPGKDGLNGLPGPIGPPGPRGRTGDSGPAGPPGPPGPPGPPGPPSGGYDFSFLPQPPQEKSQDGGRYYRA</textarea>
  <br />
  Middle chain:<br />
  <textarea class="inputchain" rows="4" cols="100">QMSYGYDEKSAGVSVPGPMGPSGPRGLPGPPGAPGPQGFQGPPGEPGEPGGSGPMGPRGPPGPPGKNGDDGEAGKPGRPGERGPPGPQGARGLPGTAGLPGMKGHRGFSGLDGAKGDAGPAGPKGEPGSPGENGAPGQMGPRGLPGERGRPGPPGTAGARGNDGAVGAAGPPGPTGPTGPPGFPGAVGAKGEAGPQGARGSEGPQGVRGEPGPPGPAGAAGPAGNPGADGQPGAKGANGAPGIAGAPGFPGARGPSGPQGPSGPPGPKGNSGEPGAPGNKGDTGAKGEPGATGVQGPPGPAGEEGKRGARGEPGPSGLPGPPGERGGPGSRGFPGADGVAGPKGPSGERGAPGPAGPKGSPGEAGRPGEAGLPGAKGLTGSPGSPGPDGKTGPPGPAGQDGRPGPAGPPGARGQAGVMGFPGPKGTAGEPGKAGERGLPGPPGAVGPAGKDGEAGAQGAPGPAGPAGERGEQGPAGSPGFQGLPGPAGPPGEAGKPGEQGVPGDLGAPGPSGARGERGFPGERGVQGPPGPAGPRGNNGAPGNDGAKGDTGAPGAPGSQGAPGLQGMPGERGAAGLPGPKGDRGDAGPKGADGSPGKDGARGLTGPIGPPGPAGAPGDKGEAGPSGPPGPTGARGAPGDRGEAGPPGPAGFAGPPGADGQPGAKGEPGDTGVKGDAGPPGPAGPAGPPGPIGNVGAPGPKGPRGAAGPPGATGFPGAAGRVGPPGPSGNAGPPGPPGPVGKEGGKGPRGETGPAGRPGEVGPPGPPGPAGEKGSPGADGPAGSPGTPGPQGIAGQRGVVGLPGQRGERGFPGLPGPSGEPGKQGPSGSSGERGPPGPMGPPGLAGPPGESGREGSPGAEGSPGRDGAPGAKGDRGETGPAGPPGAPGAPGAPGPVGPAGKNGDRGETGPAGPAGPIGPAGARGPAGPQGPRGDKGETGEQGDRGIKGHRGFSGLQGPPGSPGSPGEQGPSGASGPAGPRGPPGSAGSPGKDGLNGLPGPIGPPGPRGRTGDSGPAGPPGPPGPPGPPGPPSGGYDFSFLPQPPQEKSQDGGRYYRA</textarea>
  <br />
  Lagging chain:<br />
  <textarea class="inputchain" rows="4" cols="100">-----QYSDKGVSSGPGPMGLMGPRGPPGAVGAPGPQGFQGPAGEPGEPGQTGPAGPRGPAGSPGKAGEDGHPGKPGRPGERGVVGPQGARGFPGTPGLPGFKGVKGHSGMDGLKGQPGAQGVKGEPGAPGENGTPGQAGARGLPGERGRVGAPGPAGARGSDGSVGPVGPAGPIGSAGPPGFPGAPGPKGELGPVGNPGPAGPAGPRGEVGLPGLSGPVGPPGNPGTNGLTGAKGATGLPGVAGAPGLPGPRGIPGPAGAAGATGARGLVGEPGPAGSKGESGNKGEPGSVGAQGPPGPSGEEGKRGSPGEAGSAGPAGPPGLRGSPGSRGLPGADGRAGVMGPPGNRGSTGPAGIRGPNGDAGRPGEPGLMGPRGLPGSPGNVGPSGKEGPVGLPGIDGRPGPIGPAGPRGEAGNIGFPGPKGPSGDPGKPGERGHPGLAGARGAPGPDGNNGAQGPPGPQGVQGGKGEQGPAGPPGFQGLPGPSGTTGEVGKPGERGLPGEFGLPGPAGPRGERGTPGESGAAGPSGPIGSRGPSGAPGPDGNKGEAGAVGAPGSAGASGPGGLPGERGAAGIPGGKGEKGETGLRGDTGNTGRDGARGIPGAVGAPGPAGASGDRGEAGAAGPSGPAGPRGSPGERGEVGPAGPNGFAGPAGAAGQPGAKGEKGTKGPKGENGIVGPTGSVGAAGPSGPNGPPGPVGSRGDGGPPGMTGFPGAAGRTGPPGPSGIAGPPGPPGAAGKEGIRGPRGDQGPVGRTGETGASGPPGFVGEKGPSGEPGTAGAPGTAGPQGLLGAPGILGLPGSRGERGLPGIAGALGEPGPLGISGPPGARGPPGAVGSPGVNGAPGEAGRDGNPGSDGPPGRDGQPGHKGERGYPGSIGPTGAAGAPGPHGSVGPAGKHGNRGEPGPAGSVGPVGAVGPRGPSGPQGIRGDKGEPGDKGHRGLPGLKGYSGLQGLPGLAGLHGDQGAPGPVGPAGPRGPAGPSGPVGKDGRSGQPGPVGPAGVRGSQGSQGPAGPPGPPGPPGPPG</textarea>
  <br />
</article>
  Number of residues to stagger:
  <input type="number" id="stagger" min="0" value="1" onchange="highlightFunction()"/>
  <br />

</section>

<section class="child">

<h2>Highlight residues</h2>
<ul>
  <li>Use one letter code.</li>
  <li>All input will be automatically capitalised.</li>
  <li>Some regex works.</li>
  <ul>
    <li><strong>GP</strong> finds exactly "GP" (G <emph>and</emph> P in that order).</li>
    <li>For G or P, use <strong>[GP]</strong>.</li>
    <li><strong>[A-Z]</strong> (square brackets included) matches any one residue.</li>
    <li>For G followed by something, use <strong>G[A-Z]</strong>.</li>
    <li>For (mouse) essential amino acids, use <strong>[VLIFMWTKRH]</strong>.</li>
  </ul>
</ul> 
Specify residues to be highlighted:
<input type="text" id="selector" value="G" /><span id=counter></span>
 <br />
<!--
Select highlight colour (doesn't do anything yet):
<input type="color" id="highlightcol" value="#ff0000" />
-->

</section>
</div>

<section>
<h2>Staggered output here</h2>

<article id="results"></article>

</section>

<!--
<section>
<h2>Tidy output here</h2>
<button type="button" onClick="tidyDisplay()">Tidy</button>
<article id="tidied"></article>

</section>
-->


<script>

$( document ).ready(function() {
    defaultSearchKey();
    highlightFunction();
});

$('.inputchain').keyup(function() {
   highlightFunction();
});

function displayFunction() {
  $('#results').empty();
  sequenceArray = getStaggeredSequences();
  $.each(sequenceArray, function(index, chain) {
    var output = $('<p></p>').addClass('outputchain');
    output.append(chain);
    $('#results').append(output);
  });
};

function getStaggeredSequences() {
  var textArray = [];
  $('.inputchain').each(function(index) {
    var chain = $(this).val().toUpperCase();
    textArray.push(new Array(index + 1).join(staggerSpacer()) + chain);
  });
  return textArray;
};

function staggerSpacer() {
  var stagger = parseInt($("#stagger").val());
  return Array(stagger+1).join('-');
};

$('#selector').keyup(function() {
  this.value = this.value.toUpperCase();
  $('#counter').html("");
  highlightFunction();
});

function highlightFunction() {
    var reg2 = $("#selector").val();
    if (reg2 != '') {
      regex = new RegExp(reg2, 'ig') 
      displayFunction()
      $('#results').highlightRegex(regex);
      countMatches();
    }else{
      displayFunction();
   }
}

function countMatches() {
  var numItems = $('.highlight').length ; 

  if (numItems != 0) {
    $('#counter').html("<span> "+numItems+" matches</span>");
  } else {
    $('#counter').html("");
  }
  return numItems;
};

$.urlParam = function(name){
    var results = new RegExp('[\?&]' + name + '=([^&#]*)').exec(window.location.href);
    if (results==null){
       return null;
    }
    else{
       return results[1] || 0;
    }
}

function defaultSearchKey() {
    searchKey = $.urlParam('search');
    if (searchKey != null) {
        $('#selector').val(searchKey);
    } else {
        $('#selector').val("G");
    }
}

//~ function getHighlightedArray() {
    //~ var innerHTMLArray = [];
    //~ $('.outputchain').each(function(index) {
        //~ var chain = $(this).val();
        //~ innerHTMLArray.push(chain);
    //~ });
    //~ return innerHTMLArray;
//~ };
//~ 
//~ function tidyDisplay() {
    //~ $('#tidied').empty();
    //~ highlightedArray = getHighlightedArray();
  //~ $.each(highlightedArray, function(index, chain) {
    //~ var outputChain = $('<p></p>').addClass('tidied');
    //~ outputChain.append(chain);
    //~ $('#tidied').append(outputChain);
  //~ });
//~ };



</script>


</body>
</html>
